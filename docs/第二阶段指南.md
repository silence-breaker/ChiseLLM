# ğŸš€ ç¬¬äºŒé˜¶æ®µï¼šSFT å‚ç›´å¾®è°ƒä¸æ•°æ®å·¥ç¨‹ (SFT & Data Engineering)

**é˜¶æ®µç›®æ ‡ï¼š** åˆ©ç”¨ä½ å·²æ„å»ºçš„ `reflect_env`ï¼Œæ”»å…‹â€œå¥–åŠ±ç¨€ç–æ€§â€ï¼Œå°† LLM ç”Ÿæˆ Chisel ä»£ç çš„ **Pass@1 Compile æˆåŠŸç‡ä» <5% æå‡åˆ° >80%**ã€‚

**æ ¸å¿ƒäº¤ä»˜ç‰©ï¼š**

1. **é«˜è´¨é‡åˆæˆæ•°æ®é›†** (`chisel_sft_dataset.jsonl`)ï¼šåŒ…å« 5k-10k æ¡é€šè¿‡ `reflect` éªŒè¯çš„â€œé»„é‡‘æ•°æ®â€ã€‚
    
2. **å¾®è°ƒåçš„æ¨¡å‹æƒé‡** (LoRA Adapter)ã€‚
    

## â… . ä»»åŠ¡ä¸€ï¼šæ„å»º Chisel åˆæˆæ•°æ®å¼•æ“ (The Data Engine)

### 1.1 ä¸ºä»€ä¹ˆä½ çš„ `reflect_env` æ˜¯æ•°æ®æ¸…æ´—çš„ç¥å™¨ï¼Ÿ

ä½ ç°åœ¨çš„ `reflect_env.py` å…·æœ‰ä¸€ä¸ªç»ä½³ç‰¹æ€§ï¼š**å½“ `output_dir=None` ä¸” `testbench_path=None` æ—¶ï¼Œå®ƒåªåœ¨ä¸´æ—¶ç›®å½•è·‘ä¸€éç¼–è¯‘å’Œé˜è¿°ï¼ŒéªŒè¯å®Œåè‡ªåŠ¨æ¸…ç†ï¼Œä¸ç•™ç—•è¿¹ã€‚**

åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªâ€œè¾¹ç”Ÿæˆã€è¾¹æ¸…æ´—â€çš„æµæ°´çº¿ï¼Œè€Œä¸æ˜¯å…ˆç”Ÿæˆä¸€å †åƒåœ¾ä»£ç å†å›å¤´æ¸…æ´—ã€‚

### 1.2 æ•°æ®è¯¾ç¨‹è®¾è®¡ (Curriculum Design)

å»ºè®®ç”Ÿæˆ **10,000 æ¡** é€šè¿‡éªŒè¯çš„æ•°æ®ï¼ŒæŒ‰ä»¥ä¸‹æ¯”ä¾‹ï¼š

|è¯¾ç¨‹ç­‰çº§|å æ¯”|ç›®æ ‡|æ ¸å¿ƒå†…å®¹|
|---|---|---|---|
|**Level 1**|60%|**è¯­æ³•è‚Œè‚‰è®°å¿†**|å„ç§ç±»å‹çš„å®šä¹‰ï¼š`Wire`, `Reg`, `UInt`, `SInt`, `Bool`, `Bundle`, `Vec`ã€‚è®©æ¨¡å‹å­¦ä¼šå¦‚ä½•å£°æ˜å˜é‡è€Œä¸æŠ¥é”™ã€‚|
|**Level 2**|30%|**åŸºç¡€ç»„åˆé€»è¾‘**|`Mux`, `MuxCase`, `When/ElseWhen`, ç®—æœ¯è¿ç®—, é€»è¾‘è¿ç®—ã€‚|
|**Level 3**|10%|**ç®€å•æ—¶åºé€»è¾‘**|è®¡æ•°å™¨ (Counter), ç§»ä½å¯„å­˜å™¨ (ShiftRegister), ç®€å•çš„çŠ¶æ€æœº (FSM)ã€‚|

### 1.3 éªŒè¯é€»è¾‘é€‚é…

åœ¨ä½ çš„ç”Ÿæˆè„šæœ¬ä¸­ï¼ŒéªŒè¯é€»è¾‘å°†éå¸¸ç®€å•ï¼š

```
# ä¼ªä»£ç ï¼šåˆ©ç”¨ä½ çš„ reflect_env è¿›è¡Œæ— ç—•éªŒè¯
from src.reflect_env import reflect

def validate(code, module_name):
    result = reflect(
        chisel_code_string=code,
        module_name=module_name,
        testbench_path=None,  # ä¸è·‘ä»¿çœŸ
        output_dir=None       # ä¸ä¿å­˜æ–‡ä»¶ï¼Œåªåœ¨å†…å­˜æ£€æŸ¥
    )
    # æ ¹æ®ä½ çš„ä»£ç é€»è¾‘ï¼Œæ²¡æœ‰ testbench ä¸”ç¼–è¯‘é˜è¿°æˆåŠŸï¼Œstage ä¼šæ˜¯ 'passed'
    return result['stage'] == 'passed'
```

## â…¡. ä»»åŠ¡äºŒï¼šSFT ç¯å¢ƒæ­å»º (é’ˆå¯¹ RTX 4080 16GB)

### 2.1 æ¨¡å‹é€‰å‹ (Base Model)

é‰´äºä½ çš„æ˜¾å¡æ‹¥æœ‰ 16GB æ˜¾å­˜ï¼Œæ¨èé…ç½®ï¼š

- **ä¸»åŠ›æ¨¡å‹:** **Qwen2.5-Coder-14B-Instruct**
    
    - **å…³é”®é…ç½®:** å¿…é¡»å¼€å¯ **4-bit QLoRA** å’Œ **Gradient Checkpointing**ã€‚
        
    - **ä¼˜åŠ¿:** 14B æ¨¡å‹çš„é€»è¾‘æ¨ç†èƒ½åŠ›è¿œå¼ºäº 7Bï¼Œéå¸¸é€‚åˆ Chisel è¿™ç§å¼ºé€»è¾‘è¯­è¨€ã€‚
        
- **å¤‡é€‰æ¨¡å‹:** **Qwen2.5-Coder-7B-Instruct**
    
    - å¦‚æœ 14B è®­ç»ƒè¿‡æ…¢æˆ–æ˜¾å­˜æº¢å‡ºï¼Œéšæ—¶é€€å› 7Bã€‚
        

### 2.2 è®­ç»ƒå‚æ•°å»ºè®® (LLaMA-Factory)

- **Stage:** SFT
    
- **Quantization:** 4-bit (QLoRA)
    
- **Learning Rate:** 2e-4
    
- **Epochs:** 3 (åˆæˆæ•°æ®å¾ˆå¹²å‡€ï¼Œ3 è½®è¶³çŸ£)
    
- **Batch Size:** å°è¯• 2 æˆ– 4 (é…åˆ Gradient Accumulation è¾¾åˆ°ç­‰æ•ˆ 16 æˆ– 32)
    
- **Dataset:** ä½¿ç”¨ä½ ç”Ÿæˆçš„ `chisel_sft_dataset.jsonl`
    

## â…¢. ä»»åŠ¡ä¸‰ï¼šé—­ç¯è¯„ä¼°

1. å‡†å¤‡ 100 æ¡**æœªè§è¿‡**çš„ Prompt (æµ‹è¯•é›†)ã€‚
    
2. è®© SFT åçš„æ¨¡å‹ç”Ÿæˆä»£ç ã€‚
    
3. è°ƒç”¨ `reflect(..., output_dir="eval_results")` è·‘ä¸€éã€‚
    
4. **ç›®æ ‡æŒ‡æ ‡ï¼š** ç¼–è¯‘é€šè¿‡ç‡ (Pass@1 Compile) > **80%**ã€‚
    

## é™„å½•ï¼šæ–‡ä»¶ç»“æ„å»ºè®®

ä¸ºäº†è®©ç”Ÿæˆå™¨èƒ½æ­£ç¡® import ä½ çš„æ¨¡å—ï¼Œå»ºè®®ä¿æŒä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
Project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ reflect_env.py
â”‚   â””â”€â”€ run_reflect.py
â”œâ”€â”€ data_gen/
â”‚   â””â”€â”€ generator.py  <-- è¿è¡Œè¿™ä¸ª
â””â”€â”€ dataset/
    â””â”€â”€ chisel_sft_dataset.jsonl
```