# ChiseLLM å·¥ä½œåŒºä»‹ç»

> ğŸ“… æ›´æ–°æ—¥æœŸ: 2025-11-25  
> ğŸ¯ é¡¹ç›®ç›®æ ‡: åˆ©ç”¨ LLM è¿›è¡Œç¡¬ä»¶ä»£ç ç”Ÿæˆä¸è‡ªæˆ‘ä¿®å¤

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**ChiseLLM** æ˜¯ä¸€ä¸ªæ¢ç´¢æ€§é¡¹ç›®ï¼Œè‡´åŠ›äºå°†å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) åº”ç”¨äºåŸºäº Chisel (Scala) çš„ç¡¬ä»¶æ•æ·å¼€å‘ã€‚é¡¹ç›®çš„æ ¸å¿ƒç†å¿µæ˜¯é€šè¿‡"åå°„ç¯å¢ƒ"å®ç° **ç¼–è¯‘â†’é˜è¿°â†’ä»¿çœŸ** ä¸‰é˜¶æ®µè‡ªåŠ¨åŒ–éªŒè¯ï¼Œå¹¶åŸºäºæ­¤æ„å»ºé«˜è´¨é‡çš„ SFT è®­ç»ƒæ•°æ®é›†ã€‚

### é¡¹ç›®é˜¶æ®µ

| é˜¶æ®µ | çŠ¶æ€ | æè¿° |
|------|------|------|
| Stage 1 | âœ… å·²å®Œæˆ | åå°„ç¯å¢ƒæ„å»º - ä¸‰é˜¶æ®µè§£è€¦éªŒè¯æ¡†æ¶ |
| Stage 2 | âœ… å·²å®Œæˆ | æ•°æ®ç”Ÿæˆç®¡çº¿ - æ‰¹é‡ç”Ÿæˆ SFT è®­ç»ƒæ•°æ® (1ä¸‡æ¡) |
| Stage 3 | ğŸš§ è¿›è¡Œä¸­ | SFT å¾®è°ƒä¸é—­ç¯è¯„ä¼° |

---

## ğŸ“ ç›®å½•ç»“æ„

```text
ChiseLLM/
â”œâ”€â”€ ğŸ“„ build.sc                 # Mill æ„å»ºé…ç½® (ä»…ä¾› reflect_env å†…éƒ¨ä½¿ç”¨)
â”œâ”€â”€ ğŸ“„ README.md                # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ requirements.txt         # Python ä¾èµ–æ¸…å•
â”œâ”€â”€ ğŸ“„ LICENSE                  # å¼€æºè®¸å¯è¯
â”œâ”€â”€ ğŸ“„ quick_upload.sh          # å¿«é€Ÿä¸Šä¼ è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“‚ src/                     # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ reflect_env.py          # ğŸ”¥ åå°„ç¯å¢ƒæ ¸å¿ƒæ¨¡å— (v2.1)
â”‚   â””â”€â”€ run_reflect.py          # CLI æ¥å£è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“‚ data_gen/                # æ•°æ®ç”Ÿæˆæ¨¡å—
â”‚   â””â”€â”€ generator_V2.py         # ğŸ”¥ V2 æ•°æ®ç”Ÿæˆå™¨ (SFT è®­ç»ƒæ•°æ®)
â”‚
â”œâ”€â”€ ğŸ“‚ eval/                    # è¯„ä¼°æ¡†æ¶ (Stage 3 æ–°å¢)
â”‚   â”œâ”€â”€ generate_eval_set.py    # ğŸ”¥ æµ‹è¯•é›†ç”Ÿæˆå™¨ (å¸¦éªŒè¯)
â”‚   â”œâ”€â”€ run_eval.py             # ğŸ”¥ æ¨¡å‹è¯„ä¼°å™¨
â”‚   â””â”€â”€ eval_set_v1.jsonl       # è¯„ä¼°æµ‹è¯•é›† (37æ¡ï¼Œ100% éªŒè¯é€šè¿‡)
â”‚
â”œâ”€â”€ ğŸ“‚ dataset/                 # ç”Ÿæˆçš„æ•°æ®é›†
â”‚   â””â”€â”€ chisel_sft_dataset_*.jsonl  # SFT è®­ç»ƒæ•°æ® (JSONL æ ¼å¼ï¼Œ1ä¸‡æ¡+)
â”‚
â”œâ”€â”€ ğŸ“‚ docs/                    # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ å·¥ä½œåŒºä»‹ç».md           # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ reflect_envä½¿ç”¨æŒ‡å—.md
â”‚   â”œâ”€â”€ æ•°æ®ç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å—.md
â”‚   â”œâ”€â”€ è¯„ä¼°æ¡†æ¶ä½¿ç”¨æŒ‡å—.md     # Stage 3 æ–°å¢
â”‚   â”œâ”€â”€ ç¬¬ä¸€é˜¶æ®µæŒ‡å—.md / æˆæœæ€»ç»“.md
â”‚   â”œâ”€â”€ ç¬¬äºŒé˜¶æ®µæŒ‡å—.md / æˆæœæ€»ç»“.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                   # æµ‹è¯•æ–‡ä»¶ä¸ç¤ºä¾‹
â”‚   â”œâ”€â”€ *.scala                 # Chisel æµ‹è¯•æ¨¡å—
â”‚   â”œâ”€â”€ *.cpp                   # C++ Testbench
â”‚   â”œâ”€â”€ *.v                     # ç”Ÿæˆçš„ Verilog
â”‚   â””â”€â”€ result.json             # éªŒè¯ç»“æœ
â”‚
â”œâ”€â”€ ğŸ“‚ examples/                # ç¤ºä¾‹ä»£ç  (å¾…æ‰©å……)
â”œâ”€â”€ ğŸ“‚ logs/                    # è¿è¡Œæ—¥å¿—
â””â”€â”€ ğŸ“‚ temp/                    # ä¸´æ—¶æ–‡ä»¶
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### ç¡¬ä»¶æè¿° (å›ºå®šç‰ˆæœ¬ï¼Œä¸æ•°æ®é›†ä¸€è‡´)

| ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Scala | 2.13.12 | åŸºç¡€è¯­è¨€ |
| Chisel | 6.0.0 | ç¡¬ä»¶æ„é€ è¯­è¨€ |
| Mill | 1.0.6 | æ„å»ºå·¥å…· (å†…éƒ¨ä½¿ç”¨) |
| Verilator | 4.038+ | Verilog ä»¿çœŸå™¨ |

> âš ï¸ **æ³¨æ„**: ç‰ˆæœ¬å·²é”å®šä¸º Scala 2.13.12 + Chisel 6.0.0ï¼Œä»¥ç¡®ä¿ä¸å·²ç”Ÿæˆçš„ 1 ä¸‡æ¡æ•°æ®é›†å…¼å®¹ã€‚

### Python ç¯å¢ƒ

| ç¯å¢ƒåç§° | ç”¨é€” |
|----------|------|
| `chisel-llm` | åå°„ç¯å¢ƒã€æ•°æ®ç”Ÿæˆã€æµ‹è¯•é›†ç”Ÿæˆ |
| `chisel-train` | æ¨¡å‹è®­ç»ƒã€æ¨¡å‹è¯„ä¼° (éœ€è¦ transformers) |

---

## ğŸš€ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. åå°„ç¯å¢ƒ (`src/reflect_env.py`)

åå°„ç¯å¢ƒæ˜¯æœ¬é¡¹ç›®çš„**å”¯ä¸€ç¼–è¯‘å’ŒéªŒè¯æ–¹å¼**ï¼Œå®ç°äº† **ä¸‰é˜¶æ®µè§£è€¦éªŒè¯**ï¼š

```text
Chisel ä»£ç  â†’ [ç¼–è¯‘] â†’ [é˜è¿°] â†’ Verilog â†’ [ä»¿çœŸ] â†’ æµ‹è¯•ç»“æœ
              Stage 1    Stage 2            Stage 3
```

**ä¸»è¦åŠŸèƒ½:**

- æ¥æ”¶ Chisel/Scala ä»£ç å­—ç¬¦ä¸²
- è‡ªåŠ¨ç¼–è¯‘ (Scala compilation)
- è‡ªåŠ¨é˜è¿° (Chisel elaboration to Verilog)
- è‡ªåŠ¨ä»¿çœŸ (Verilator simulation with C++ testbench)
- è¿”å›è¯¦ç»†çš„"ä½“æ£€æŠ¥å‘Š" (JSON æ ¼å¼)

**ä½¿ç”¨æ–¹å¼:**

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate chisel-llm

# ç¼–è¯‘å’Œé˜è¿°
python src/run_reflect.py --file tests/my_module.scala

# å®Œæ•´æµ‹è¯•ï¼ˆå«ä»¿çœŸï¼‰
python src/run_reflect.py --file tests/my_module.scala --testbench tests/tb_my_module.cpp
```

### 2. æ•°æ®ç”Ÿæˆå™¨ (`data_gen/generator_V2.py`)

åŸºäºæ¨¡æ¿çš„æ‰¹é‡ SFT æ•°æ®ç”Ÿæˆå™¨ï¼Œæ”¯æŒï¼š

- **Level 1**: Wire/Reg å®šä¹‰ã€åŸºæœ¬ç±»å‹
- **Level 2**: ç»„åˆé€»è¾‘ (ç®—æœ¯ã€MUXã€When)
- **Level 3**: ç®€å•æ—¶åºé€»è¾‘ (è®¡æ•°å™¨ã€ç§»ä½å¯„å­˜å™¨)

**ä½¿ç”¨æ–¹å¼:**

```bash
conda activate chisel-llm

# ç”Ÿæˆ 100 æ¡æ ·æœ¬ï¼Œä½¿ç”¨ 4 ä¸ªå¹¶è¡Œè¿›ç¨‹
python data_gen/generator_V2.py 100 4
```

**è¾“å‡ºæ ¼å¼:** JSONLï¼Œæ¯è¡ŒåŒ…å« `instruction`, `input`, `output` ä¸‰å­—æ®µã€‚

### 3. è¯„ä¼°æ¡†æ¶ (`eval/`)

ç”¨äºè¯„ä¼°æ¨¡å‹ Chisel ä»£ç ç”Ÿæˆèƒ½åŠ›çš„å®Œæ•´æ¡†æ¶ï¼Œé‡‡ç”¨**æµ‹è¯•é›†ç”Ÿæˆ**ä¸**æ¨¡å‹è¯„ä¼°**è§£è€¦è®¾è®¡ï¼š

**æµ‹è¯•é›†ç”Ÿæˆå™¨ (`generate_eval_set.py`):**
- åŸºäºæ¨¡æ¿ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
- æ‰€æœ‰å‚è€ƒä»£ç éƒ½é€šè¿‡åå°„ç¯å¢ƒéªŒè¯
- æ”¯æŒå¤šè¿›ç¨‹å¹¶è¡ŒéªŒè¯

```bash
conda activate chisel-llm

# ç”Ÿæˆå¹¶éªŒè¯æµ‹è¯•é›†
python eval/generate_eval_set.py -o eval/eval_set_v1.jsonl -j 4
```

**æ¨¡å‹è¯„ä¼°å™¨ (`run_eval.py`):**
- æ”¯æŒæœ¬åœ°æ¨¡å‹ (transformers) å’Œ API æœåŠ¡
- åˆ©ç”¨åå°„ç¯å¢ƒè¿›è¡ŒçœŸæ­£çš„ç¼–è¯‘éªŒè¯
- è¾“å‡ºè¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š

```bash
conda activate chisel-train

# è¯„ä¼°æ¨¡å‹
python eval/run_eval.py -e eval/eval_set_v1.jsonl -m Qwen/Qwen2.5-Coder-14B-Instruct
```

---

## ğŸ“Š æ•°æ®èµ„äº§

| æ–‡ä»¶ | æè¿° |
|------|------|
| `dataset/chisel_sft_dataset_*.jsonl` | ç”Ÿæˆçš„ SFT è®­ç»ƒæ•°æ® (1ä¸‡æ¡+) |
| `eval/eval_set_v1.jsonl` | è¯„ä¼°æµ‹è¯•é›† (37æ¡ï¼ŒL1-L4ï¼Œ100% éªŒè¯é€šè¿‡) |
| `logs/generation_errors_*.log` | ç”Ÿæˆè¿‡ç¨‹ä¸­çš„é”™è¯¯æ—¥å¿— |
| `tests/result.json` | æœ€è¿‘ä¸€æ¬¡åå°„éªŒè¯çš„ç»“æœ |

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| [reflect_envä½¿ç”¨æŒ‡å—](reflect_envä½¿ç”¨æŒ‡å—.md) | **åå°„ç¯å¢ƒ API æ–‡æ¡£ (æ ¸å¿ƒ)** |
| [æ•°æ®ç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å—](æ•°æ®ç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å—.md) | ç”Ÿæˆå™¨ä½¿ç”¨è¯´æ˜ |
| [è¯„ä¼°æ¡†æ¶ä½¿ç”¨æŒ‡å—](è¯„ä¼°æ¡†æ¶ä½¿ç”¨æŒ‡å—.md) | **è¯„ä¼°æ¡†æ¶ä½¿ç”¨è¯´æ˜ (Stage 3)** |
| [ç¬¬ä¸€é˜¶æ®µæŒ‡å—](ç¬¬ä¸€é˜¶æ®µæŒ‡å—.md) | åå°„ç¯å¢ƒæ„å»ºæŒ‡å— |
| [ç¬¬ä¸€é˜¶æ®µæˆæœæ€»ç»“](ç¬¬ä¸€é˜¶æ®µæˆæœæ€»ç»“.md) | Stage 1 å®ŒæˆæŠ¥å‘Š |
| [ç¬¬äºŒé˜¶æ®µæŒ‡å—](ç¬¬äºŒé˜¶æ®µæŒ‡å—.md) | æ•°æ®ç”Ÿæˆç®¡çº¿æŒ‡å— |
| [ç¬¬äºŒé˜¶æ®µæˆæœæ€»ç»“](ç¬¬äºŒé˜¶æ®µæˆæœæ€»ç»“.md) | Stage 2 è¿›å±•æŠ¥å‘Š |
| [sbt_vs_mill_å¯¹æ¯”](sbt_vs_mill_å¯¹æ¯”.md) | æ„å»ºå·¥å…·é€‰å‹åˆ†æ |
| [AIChisel-Verilogç§‘ç ”æŒ‡å—](AIChisel-Verilogç§‘ç ”æŒ‡å—.md) | ç§‘ç ”æ–¹å‘å‚è€ƒ |

---

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´» Conda ç¯å¢ƒ (å¿…é¡»)
conda activate chisel-llm

# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# ç¡®ä¿ Verilator å·²å®‰è£…
verilator --version
```

### 2. å•æ ·æœ¬éªŒè¯

```bash
conda activate chisel-llm

python src/run_reflect.py \
    --file tests/ten_timer.scala \
    --testbench tests/tb_ten_timer.cpp
```

### 3. æ‰¹é‡ç”Ÿæˆæ•°æ®

```bash
conda activate chisel-llm

python data_gen/generator_V2.py 100 4
```

---

## âš ï¸ é‡è¦è¯´æ˜

### å…³äº IDE é›†æˆ

æœ¬é¡¹ç›®**ä¸ä½¿ç”¨** VS Code Metals æ’ä»¶è¿›è¡Œ Scala/Chisel å¼€å‘ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. **ç‰ˆæœ¬å…¼å®¹æ€§**: Metals è¦æ±‚è¾ƒæ–°çš„ Scala ç‰ˆæœ¬ (2.13.14+)ï¼Œä½† Chisel 6.0.0 ä»…æ”¯æŒ Scala 2.13.12
2. **æ•°æ®é›†ä¸€è‡´æ€§**: å·²ç”Ÿæˆçš„ 1 ä¸‡æ¡æ•°æ®é›†åŸºäº Chisel 6.0.0ï¼Œå‡çº§ç‰ˆæœ¬ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜
3. **åå°„ç¯å¢ƒ**: `run_reflect.py` å·²æä¾›å®Œæ•´çš„ç¼–è¯‘ã€é˜è¿°ã€ä»¿çœŸåŠŸèƒ½ï¼Œæ— éœ€ IDE é›†æˆ

### ç¼–è¯‘æ–¹å¼

| âŒ ä¸æ¨è | âœ… æ¨è |
|----------|--------|
| VS Code Metals | `python src/run_reflect.py` |
| `mill chiselllm.compile` | `python data_gen/generator_V2.py` |
| `sbt compile` | - |

---

## ğŸ”® åç»­è§„åˆ’

1. **è¯„ä¼°åŸºåº§æ¨¡å‹**: ä½¿ç”¨æµ‹è¯•é›†è¯„ä¼° Qwen2.5-Coder-14B çš„åŸºçº¿æ€§èƒ½
2. **SFT è®­ç»ƒ**: åŸºäºç”Ÿæˆçš„ 1 ä¸‡æ¡æ•°æ®é›†å¾®è°ƒæ¨¡å‹
3. **é—­ç¯è¯„ä¼°**: å¯¹æ¯” SFT å‰åçš„ Pass@1 Compile æå‡
4. **æ¨¡æ¿æ‰©å±•**: å¢åŠ æ›´å¤æ‚çš„æ—¶åºé€»è¾‘ã€æ¥å£åè®® (Valid-Ready)ã€å‚æ•°åŒ–æ¨¡å—

---

## ğŸ“ è´¡çŒ®æŒ‡å—

1. æ–°å¢æ¨¡æ¿è¯·æ”¾ç½®åœ¨ `data_gen/` ç›®å½•
2. æµ‹è¯•æ–‡ä»¶è¯·æ”¾ç½®åœ¨ `tests/` ç›®å½•
3. æ–‡æ¡£æ›´æ–°è¯·æ”¾ç½®åœ¨ `docs/` ç›®å½•
4. **æäº¤å‰è¯·ç¡®ä¿é€šè¿‡åå°„ç¯å¢ƒéªŒè¯**

---

æœ¬æ–‡æ¡£ç”± ChiseLLM é¡¹ç›®ç»´æŠ¤ | æ›´æ–°äº 2025-11-25
